<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Starting Clay Terminal Backend...</title>
  <style>
    body {
      font-family: 'Menlo', monospace;
      background: #1e1e2e;
      color: #cdd6f4;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }
    .container {
      text-align: center;
      padding: 32px;
      background: #181825;
      border-radius: 12px;
      border: 2px solid #cba6f7;
      max-width: 500px;
    }
    h1 {
      color: #cba6f7;
      margin: 0 0 24px 0;
    }
    .status {
      margin: 24px 0;
      padding: 16px;
      background: #11111b;
      border-radius: 8px;
      font-family: monospace;
    }
    .command {
      background: #11111b;
      padding: 12px;
      border-radius: 6px;
      margin: 16px 0;
      color: #a6e3a1;
      font-family: monospace;
      word-break: break-all;
    }
    button {
      background: #cba6f7;
      color: #1e1e2e;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 16px;
    }
    button:hover {
      background: #b4befe;
    }
    .spinner {
      border: 3px solid #313244;
      border-top: 3px solid #cba6f7;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 24px auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üöÄ Clay Terminal</h1>
    <div class="status" id="status">
      <div class="spinner"></div>
      <p>Checking backend connection...</p>
    </div>
    <div class="command" id="command" style="display: none;">
      <strong>Run this command:</strong><br>
      <code id="command-text"></code>
    </div>
    <button id="retry-btn" onclick="checkBackend()" style="display: none;">Retry Connection</button>
  </div>

  <script>
    async function checkBackend() {
      const statusEl = document.getElementById('status');
      const commandEl = document.getElementById('command');
      const commandText = document.getElementById('command-text');
      const retryBtn = document.getElementById('retry-btn');
      
      statusEl.innerHTML = '<div class="spinner"></div><p>Checking backend...</p>';
      commandEl.style.display = 'none';
      retryBtn.style.display = 'none';
      
      try {
        const response = await fetch('http://localhost:3000/api/health', {
          method: 'GET',
          mode: 'no-cors',
          signal: AbortSignal.timeout(2000)
        });
        
        // If we get here, backend is running
        statusEl.innerHTML = '<p style="color: #a6e3a1;">‚úÖ Backend is running!</p><p>Redirecting to terminal...</p>';
        setTimeout(() => {
          window.location.href = '/';
        }, 1000);
      } catch (error) {
        // Backend not running
        statusEl.innerHTML = '<p style="color: #f38ba8;">‚ùå Backend not running</p>';
        
        // Determine the command based on current path
        const path = window.location.pathname;
        let command = 'cd backend && npm start';
        
        if (path.includes('/dist/')) {
          command = 'cd ../../backend && npm start';
        }
        
        commandText.textContent = command;
        commandEl.style.display = 'block';
        retryBtn.style.display = 'block';
      }
    }
    
    // Check immediately
    checkBackend();
    
    // Auto-retry every 3 seconds
    setInterval(checkBackend, 3000);
  </script>
</body>
</html>

